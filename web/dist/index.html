<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JMRI Easy UI</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Prevent FOUC (removed on load) -->
    <style>
      html.preload-hide #app {
        visibility: hidden;
      }
    </style>
    <script>
      document.documentElement.classList.add("preload-hide");
      window.addEventListener(
        "load",
        () => {
          document.documentElement.classList.remove("preload-hide");
        },
        { once: true }
      );
    </script>
    <script type="module" crossorigin src="/easy/assets/index-DVRZBrqs.js"></script>
    <link rel="stylesheet" crossorigin href="/easy/assets/index-B8CklBxN.css">
  </head>
  <body>
    <div id="app">
      <!-- Drawer -->
      <aside id="drawer" class="drawer">
        <div class="drawer-header">
          <div class="logo-square"></div>
          <div id="railroadName" class="railroad-name">My Railroad</div>
        </div>
        <nav class="drawer-nav">
          <button id="navRoster" class="nav-btn active" data-view="roster">Roster</button>
          <button id="navTurnouts" class="nav-btn" data-view="turnouts">Turnouts</button>
          <button id="navLights" class="nav-btn" data-view="lights">Lights</button>
          <button id="navSettings" class="nav-btn" data-view="settings">Settings</button>
        </nav>
      </aside>

      <!-- Roster Panel -->
      <section id="panelRoster" class="sectionContainer" data-panel="roster">
        <header class="topbar">
          <button id="menuBtn" class="icon-btn">☰</button>
          <h1 class="title">Roster</h1>
          <div class="spacer"></div>
          <div class="split-add">
            <button id="addBtn" class="btn btn-primary add-button" type="button">Add Loco</button>

            <div class="split-add__more">
              <button
                id="addLocoMore"
                class="btn btn-slim"
                type="button"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-controls="addLocoMenu"
                title="More ways to add"
              >
                <!-- chevron down -->
                <svg class="chev" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path
                    d="M7 10l5 5 5-5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>

              <div id="addLocoMenu" class="menu" role="menu" hidden>
                <button class="menu-item" type="button" role="menuitem" data-action="manual">
                  Manual Add
                </button>
                <button class="menu-item" type="button" role="menuitem" data-action="copy">
                  Copy Existing
                </button>
                <button class="menu-item" type="button" role="menuitem" data-action="upload">
                  Upload XML
                </button>
              </div>
            </div>
          </div>
        </header>
        <section id="rosterList" class="panel-body main content" aria-live="polite"></section>
      </section>

      <!-- Turnouts Panel -->
      <section id="panelTurnouts" class="sectionContainer" data-panel="turnouts" hidden>
        <header class="topbar">
          <button id="menuBtn" class="icon-btn">☰</button>
          <h1 class="title">Turnouts</h1>
          <div class="spacer"></div>
          <div class="split-add">
            <button id="turnoutsAddBtn" class="btn btn-primary add-button" type="button">
              Add Turnout
            </button>

            <div class="split-add__more">
              <button
                id="addTurnoutMore"
                class="btn btn-slim"
                type="button"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-controls="addTurnoutMenu"
                title="More ways to add"
              >
                <!-- chevron down -->
                <svg class="chev" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path
                    d="M7 10l5 5 5-5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>

              <div id="addTurnoutMenu" class="menu" role="menu" hidden>
                <button class="menu-item" type="button" role="menuitem" data-action="single">
                  Add Single
                </button>
                <button class="menu-item" type="button" role="menuitem" data-action="sequential">
                  Add Sequential
                </button>
              </div>
            </div>
          </div>
        </header>
        <section id="turnoutsList" class="panel-body main content" aria-live="polite">
          <div class="empty">
            <div class="empty-title">No turnouts yet</div>
            <div class="empty-subtitle">Add a turnout to get started.</div>
          </div>
        </section>
      </section>

      <!-- Lights Panel -->
      <section id="panelLights" class="sectionContainer" data-panel="lights" hidden>
        <header class="topbar">
          <button id="menuBtn" class="icon-btn">☰</button>
          <h1 class="title">Lights</h1>
          <div class="spacer"></div>
          <div class="split-add">
            <button id="lightsAddBtn" class="btn btn-primary add-button" type="button">
              Add Light
            </button>

            <div class="split-add__more">
              <button
                id="addLightMore"
                class="btn btn-slim"
                type="button"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-controls="addLightMenu"
                title="More ways to add"
              >
                <!-- chevron down -->
                <svg class="chev" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path
                    d="M7 10l5 5 5-5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>

              <div id="addLightMenu" class="menu" role="menu" hidden>
                <button class="menu-item" type="button" role="menuitem" data-action="single">
                  Add Single
                </button>
                <button class="menu-item" type="button" role="menuitem" data-action="sequential">
                  Add Sequential
                </button>
              </div>
            </div>
          </div>
        </header>
        <section id="lightsList" class="panel-body main content" aria-live="polite">
          <div class="empty">
            <div class="empty-title">No lights yet</div>
            <div class="empty-subtitle">Add a light to get started.</div>
          </div>
        </section>
      </section>
      <!-- Settings Panel -->
      <section id="panelSettings" class="sectionContainer" data-panel="settings" hidden>
        <header class="topbar">
          <button id="menuBtn" class="icon-btn">☰</button>
          <h1 class="title">Settings</h1>
        </header>
        <section id="settingsList" class="panel-body main content" aria-live="polite">
          <div class="grid">
            <label>
              JMRI Active Connection
              <div class="row row--dcc">
                <select id="jmriConnectionSelect" aria-label="Active Connection">
                  <option value="" selected>Select the connection to use...</option>
                </select>
              </div>
            </label>
          </div>
        </section>
      </section>
    </div>

    <!-- Loco Dialog (with Tabs) -->
    <dialog id="locoDialog" class="modal">
      <form method="dialog" class="modal-form">
        <header class="modal-head">
          <strong id="locoDialogTitle">Edit Locomotive</strong>

          <!-- Tabs sit to the right of the title -->
          <div class="tabs" role="tablist" aria-label="Locomotive sections">
            <button
              class="tab"
              role="tab"
              id="locoTabInfo"
              aria-controls="locoPanelInfo"
              aria-selected="true"
              type="button"
            >
              Info
            </button>
            <button
              class="tab"
              role="tab"
              id="locoTabFunctions"
              aria-controls="locoPanelFunctions"
              aria-selected="false"
              type="button"
            >
              Functions
            </button>
          </div>

          <button id="locoClose" type="button" class="icon-btn last-item">✕</button>
        </header>

        <div class="modal-body">
          <!-- Info panel (overview) -->
          <section id="locoPanelInfo" role="tabpanel" aria-labelledby="locoTabInfo" tabindex="0">
            <div class="image-col">
              <div id="modalImageDrop" class="image-drop">
                <img id="modalRosterImage" class="modal-roster-image" alt="" />
                <input type="file" id="modalImageInput" accept="image/*" hidden />
                <div class="image-hint">Tap or drop to add/replace image</div>
              </div>
            </div>

            <div class="form-col">
              <div class="grid">
                <label>ID<input id="locoId" required /></label>

                <label>
                  DCC Address
                  <div class="row row--dcc">
                    <input id="locoDccAddress" type="text" inputmode="numeric" />
                    <button type="button" id="locoReadAddress" class="btn">Read from Loco</button>
                    <button type="button" id="locoWriteAddress" class="btn btn-primary">
                      Write to Loco
                    </button>
                  </div>
                </label>

                <label>Road<input id="locoRoadName" /></label>

                <label>
                  Number
                  <input id="locoNumber" inputmode="numeric" maxlength="10" pattern="\\d{1,10}" />
                </label>

                <label>Model<input id="locoModel" /></label>
                <label>Owner<input id="locoOwner" /></label>

                <label>
                  DCC Decoder
                  <div class="row row--dcc">
                    <select id="locoDecoderSelect" aria-label="Decoder">
                      <option value="" selected>Read from Loco to find decoder...</option>
                    </select>
                    <button type="button" id="locoDecoderRead" class="btn">Read from Loco</button>
                  </div>
                </label>

                <input type="hidden" id="locoFile" />
                <input type="hidden" id="locoImageUrl" />
              </div>
            </div>
          </section>

          <!-- Functions panel -->
          <section
            id="locoPanelFunctions"
            role="tabpanel"
            aria-labelledby="locoTabFunctions"
            tabindex="1"
            hidden
          >
            <div class="fn-actions">
              <button type="button" id="fnAdd" class="btn">Add Function</button>
              <select id="fnCopySelect"></select>
            </div>

            <!-- Mobile-first list of function cards -->
            <ul id="fnList" class="fn-list" aria-live="polite"></ul>
          </section>
        </div>

        <footer class="modal-foot">
          <button type="button" id="locoDelete" hidden="" class="btn btn-warn">Delete</button>
          <div class="spacer"></div>
          <button type="button" id="locoCancel" class="btn">Cancel</button>
          <button type="button" id="locoSave" class="btn-primary">Save</button>
        </footer>
      </form>
    </dialog>

    <!-- Turnout Dialog -->
    <dialog id="turnoutDialog" class="modal">
      <form method="dialog" class="modal-form" id="turnoutForm">
        <header class="modal-head">
          <strong id="turnoutDialogTitle">Edit Turnout</strong>
          <button id="turnoutClose" type="button" class="icon-btn last-item">✕</button>
        </header>

        <div class="modal-body">
          <div class="form-col">
            <div class="grid">
              <label>
                Connection Prefix
                <select id="toPrefixSelect"></select>
              </label>

              <label>
                DCC Address
                <input id="toSystemName" inputmode="numeric" required />
              </label>

              <label id="toCountRow" class="row" hidden>
                <span>Number of Turnouts</span>
                <input
                  id="toCount"
                  type="number"
                  min="1"
                  max="99"
                  step="1"
                  value="1"
                  inputmode="numeric"
                  pattern="\d*"
                />
              </label>

              <label>
                Friendly Name
                <input id="toUserName" />
              </label>

              <label>
                Comment
                <input id="toComment" />
              </label>

              <label class="row row--stack">
                <span>Inverted</span>
                <input id="toInverted" type="checkbox" />
              </label>

              <label>
                Throw State
                <select id="toState">
                  <option value="">(leave unchanged)</option>
                  <option value="closed">Closed</option>
                  <option value="thrown">Thrown</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <footer class="modal-foot">
          <button type="button" id="turnoutDelete" hidden="" class="btn btn-warn">Delete</button>
          <div class="spacer"></div>
          <button type="button" id="turnoutCancel" class="btn">Cancel</button>
          <button type="button" id="turnoutSave" class="btn-primary">Save</button>
        </footer>
      </form>
    </dialog>

    <!-- Lights Dialog -->
    <dialog id="lightDialog" class="modal">
      <form method="dialog" class="modal-form" id="lightForm">
        <header class="modal-head">
          <strong id="lightDialogTitle">Edit Light</strong>
          <button id="lightClose" type="button" class="icon-btn last-item">✕</button>
        </header>

        <div class="modal-body">
          <div class="form-col">
            <div class="grid">
              <label>
                Connection Prefix
                <select id="toLightPrefixSelect"></select>
              </label>

              <label>
                DCC Address
                <input id="toLightSystemName" inputmode="numeric" required />
              </label>

              <label id="toLightCountRow" class="row" hidden>
                <span>Number of Lights</span>
                <input
                  id="toLightCount"
                  type="number"
                  min="1"
                  max="99"
                  step="1"
                  value="1"
                  inputmode="numeric"
                  pattern="\d*"
                />
              </label>

              <label>
                Friendly Name
                <input id="toLightUserName" />
              </label>

              <label>
                Comment
                <input id="toLightComment" />
              </label>

              <label>
                Light State
                <select id="toLightState">
                  <option value="">(leave unchanged)</option>
                  <option value="on">On</option>
                  <option value="off">Off</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <footer class="modal-foot">
          <button type="button" id="lightDelete" hidden="" class="btn btn-warn">Delete</button>
          <div class="spacer"></div>
          <button type="button" id="lightCancel" class="btn">Cancel</button>
          <button type="button" id="lightSave" class="btn-primary">Save</button>
        </footer>
      </form>
    </dialog>

    <dialog id="toastLayer" aria-hidden="true">
      <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
    </dialog>
  </body>
</html>
